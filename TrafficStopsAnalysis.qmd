---
title: ""
description: |
  An analysis 
author: Uras Uyal
date: April 29, 2025
format: html
execute: 
  warning: false
  message: false
---

In this analysis, our goal is to examine and analyze any trends between citations and warnings for police stops. We will be using data from the Stanford Open Policing Project, which has data from 42 states with many subdivisions, and is cited down below. We will be looking at the trends in California cities, and although they have data on a number of cities, data on whether if citations were issued and whether if warnings were issued both exist for only 4 cities: Oakland, San Francisco, San Diego, and Stockton. Therefore, we will be analyzing any common trends between these cities. We will also aim to draw a conclusion on whether if these cities may have more lenient or more strict treshholds regarding punishments (as shown by the rates of citations and warnings).

We first connect to the SQL server:

```{r}
library(DBI)
library(RMariaDB)
con_traffic <- DBI::dbConnect(
  RMariaDB::MariaDB(),
  dbname = "traffic",
  host = Sys.getenv("TRAFFIC_HOST"),
  user = Sys.getenv("TRAFFIC_USER"),
  password = Sys.getenv("TRAFFIC_PWD")
)
```


Now, we import the data from the SQL server: 

```{sql connection=con_traffic}
#| output.var: "traffic_stops_california"

SELECT 
  'Oakland' AS city,
  citation_issued,
  warning_issued,
  MONTH(date) AS month,
  type,
  reason_for_stop
FROM ca_oakland_2020_04_01
WHERE date IS NOT NULL
  AND citation_issued IS NOT NULL
  AND warning_issued IS NOT NULL
  AND type = 'vehicular'
  AND reason_for_stop = 'TRAFFIC VIOLATION'
  AND YEAR(date) = 2014
  AND NOT (citation_issued = 1 AND warning_issued = 1)

UNION ALL

SELECT 
  'San Francisco' AS city,
  citation_issued,
  warning_issued,
  MONTH(date) AS month,
  type,
  reason_for_stop
FROM ca_san_francisco_2020_04_01
WHERE date IS NOT NULL
  AND citation_issued IS NOT NULL
  AND warning_issued IS NOT NULL
  AND type = 'vehicular'
  AND reason_for_stop = 'TRAFFIC VIOLATION'
  AND YEAR(date) = 2014
  AND NOT (citation_issued = 1 AND warning_issued = 1)

UNION ALL

SELECT 
  'San Diego' AS city,
  citation_issued,
  warning_issued,
  MONTH(date) AS month,
  type,
  reason_for_stop
FROM ca_san_diego_2020_04_01
WHERE date IS NOT NULL
  AND citation_issued IS NOT NULL
  AND warning_issued IS NOT NULL
  AND type = 'vehicular'
  AND reason_for_stop = 'TRAFFIC VIOLATION'
  AND YEAR(date) = 2014
  AND NOT (citation_issued = 1 AND warning_issued = 1)

UNION ALL

SELECT 
  'Stockton' AS city,
  citation_issued,
  warning_issued,
  MONTH(date) AS month,
  type,
  reason_for_stop
FROM ca_stockton_2020_04_01
WHERE date IS NOT NULL
  AND citation_issued IS NOT NULL
  AND warning_issued IS NOT NULL
  AND type = 'vehicular'
  AND reason_for_stop = 'TRAFFIC VIOLATION'
  AND YEAR(date) = 2014
  AND NOT (citation_issued = 1 AND warning_issued = 1);
    
```
Since Oakland, San Francisco, San Diego, and Stockton all have their own separate data tables, we join them unionwise. In our data table, we want the city name, whether if a citation was issued, and whether if a warning was issued. Also, we only want to see the data that was for traffic stops (not pedestrians) and those that are for traffic violations, so that we do not include ones that are civilian-initiated (like calls for help). Our data existed fully for all cities only between January 2014 and March 2015, so, to keep things consistent, we will only analyze data in 2014. The months those traffic stops happened are numbered 1 through 12. Citations and warnings are usually mutually exclusive; however, it is possible that both may have happened at the same time (perhaps the officer changed their minds, or both a citation and a warning were given for two different reasons in the same stop, etc.). In order to eliminate doubles, we also remove any single stop counting for both a citation and a warning.

Before we continue with data visualization, it is good practice to disconnect from the SQL server:

```{r}
DBI::dbDisconnect(con_traffic)
```

Now, on to data visualization and analysis. It is now possible for a traffic stop in our data set to result in no warning or citation, result in a warning, or result in a citation. No warning or citation is the least severe punishment (no punishment at all) and resulting in a citation is the most severe. The ratio-wise prevalence of citations and warnings *could* be an indicator of how severely traffic stops are handled. However, they also *could* be an indicator of how accurate the officers are at assessing when to pull over people. In order to dig deep into actual severity of how traffic stops are handled, we can look at the ratio between how many warnings are given and how many citations are given. There being *either* a citation or a warning will ensure that the driver was actually seen as to be in fault, and will compare how severely that fault was being punished:

